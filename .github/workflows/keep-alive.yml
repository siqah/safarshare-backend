name: Keep Backend Alive

on:
  schedule:
    - cron: '*/10 * * * *'
  workflow_dispatch:

permissions: {}

concurrency:
  group: keep-alive-${{ github.workflow }}
  cancel-in-progress: true

jobs:
  ping:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    env:
      BASE_URL: https://safarishare-backend.onrender.com
      USER_AGENT: GitHub-Actions-KeepAlive/1.1
    steps:
      - name: Health ping
        shell: bash
        run: |
          set -euo pipefail
          echo "UTC: $(date -u)"
          code=$(curl -sS -o /dev/null -w "%{http_code}" \
            -H "User-Agent: ${USER_AGENT}" \
            --max-time 20 \
            --retry 2 --retry-delay 3 --retry-all-errors \
            --location \
            "${BASE_URL}/api/health")
          echo "Health HTTP: ${code}"
          test "${code}" -ge 200 -a "${code}" -lt 300
